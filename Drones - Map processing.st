Object subclass: #MapTransformer	instanceVariableNames: 'transformations behavior'	classVariableNames: ''	package: 'Drones - Map processing'!!MapTransformer methodsFor: 'private - transforming' stamp: 'LoicLagadec 2/17/2025 10:31'!darker: aValueself transformations  add: (Array with: #darker: with: (Array with: aValue))! !!MapTransformer methodsFor: 'private - transforming' stamp: 'LoicLagadec 2/17/2025 10:30'!magnifyBy: aFactorself transformations  add: (Array with: #magnifyBy: with: (Array with: aFactor))! !!MapTransformer methodsFor: 'private - transforming' stamp: 'LoicLagadec 2/17/2025 10:37'!grayScaleself transformations  add: (Array with: #asGrayScale with: #())! !!MapTransformer methodsFor: 'color transformation' stamp: 'LoicLagadec 3/5/2025 17:42'!average: aMap ^	ImageForm newImageColor: (self averageColor:aMap) width: aMap data width height: aMap data height! !!MapTransformer methodsFor: 'color transformation' stamp: 'LoicLagadec 3/5/2025 17:42'!rgbDominant: aMap		^ImageForm newImageColor: (self rgbDominantColor:aMap) width: aMap data width height: aMap data height! !!MapTransformer methodsFor: 'color transformation' stamp: 'LoicLagadec 3/5/2025 17:42'!dominant: aMap		^ImageForm newImageColor: (self dominantColor:aMap) width: aMap data width height: aMap data height! !!MapTransformer methodsFor: 'initializing' stamp: 'LoicLagadec 2/17/2025 10:32'!initializetransformations := OrderedCollection new ! !!MapTransformer methodsFor: 'accessing' stamp: 'LoicLagadec 3/5/2025 17:56'!behavior: anObject	behavior := anObject! !!MapTransformer methodsFor: 'accessing' stamp: 'LoicLagadec 3/5/2025 17:56'!behavior	^ behavior! !!MapTransformer methodsFor: 'accessing' stamp: 'LoicLagadec 2/17/2025 10:34'!transformations	^ transformations! !!MapTransformer methodsFor: 'processing' stamp: 'LoicLagadec 3/5/2025 17:55'!processOver: aMap"| img |img := image copy.self transformations do:[:a| img := img perform a first withArguments: a last.].^image "self behavior value: self value: aMap! !!MapTransformer methodsFor: 'color mapping' stamp: 'LoicLagadec 3/24/2025 17:31'!rgbDominantColor: aMap | color |color := (self averageColor: aMap) colorAt:1@1.(color red >= color blue) & (color red >= color green) ifTrue:[^Color red].(color blue >= color red) & (color blue >= color green) ifTrue:[^Color blue].^Color green! !!MapTransformer methodsFor: 'color mapping' stamp: 'LoicLagadec 3/24/2025 17:28'!averageColor: aMap |r g b |r := 0.g := 0.b := 0.1 to:256 do:[:x|	1 to: 256 do:[:y|		r := r + (aMap data colorAt: x@y)red.			g := g + (aMap data colorAt: x@y)green.				b := b + (aMap data colorAt: x@y)blue.		]].r := r / 16384.g := g / 16384.b := b / 16384.	^ImageForm newImageColor: (Color r:r g:g b:b) width: aMap data width height: aMap data height! !!MapTransformer methodsFor: 'color mapping' stamp: 'LoicLagadec 3/5/2025 17:42'!dominantColor: aMap ^aMap data dominantColor! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MapTransformer class	instanceVariableNames: ''!!MapTransformer class methodsFor: 'example' stamp: 'LoicLagadec 3/24/2025 16:51'!dominantColor^self new behavior:  [:s :aMap| aMap data: (s dominant:  aMap )]; yourself! !!MapTransformer class methodsFor: 'example' stamp: 'LoicLagadec 3/24/2025 16:52'!rgbDominantColor^self new behavior:  [:s :aMap| aMap data: (s rgbDominantColor:    aMap )]; yourself! !!MapTransformer class methodsFor: 'example' stamp: 'LoicLagadec 3/24/2025 16:58'!average^self new behavior:  [:s :aMap| aMap data: (s average:  aMap )]; yourself! !!MapTransformer class methodsFor: 'example' stamp: 'LoicLagadec 3/24/2025 16:57'!averageColor^self new behavior:  [:s :aMap| aMap data: (s averageColor:  aMap )]; yourself! !!MapTransformer class methodsFor: 'example' stamp: 'LoicLagadec 3/5/2025 18:05'!defaultBehavior ^[:s :aMap| aMap data: (s dominant:  aMap )]! !!MapTransformer class methodsFor: 'instance creation' stamp: 'LoicLagadec 3/5/2025 17:53'!example^self processing: self defaultBehavior ! !!MapTransformer class methodsFor: 'instance creation' stamp: 'LoicLagadec 3/5/2025 17:44'!processing: aBlock^self new behavior: aBlock; yourself! !